
global(
    workDirectory="/var/spool/rsyslog"
)

# Load the input modules for system and kernel logging.
# module(load="imuxsock")  # Local system logs (e.g., from journald)
# module(load="imklog")    # Kernel log capture

module(load="imfile"
    readTimeout="500" # Sets the multi-line read timeout in seconds
)

# Custom template for 'noTimestampFormat' format
template(name="noTimestampFormat" type="string"
    string="%syslogtag%%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n"
)

# Extract service name and PID from filename pattern: {service}.log.{pid}
set $!service = re_extract($!metadata!filename, ".*/([^/]+)\\.log\\.([0-9]+)", 0, 1, "system");
set $!pid = re_extract($!metadata!filename, ".*/([^/]+)\\.log\\.([0-9]+)", 0, 2, "0");

# Format with both service and PID info
template(name="ServiceWithPID" type="string"
    string="%$!service%[%$!pid%]:%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n")

# Output all messages to stdout
action(type="omfile"
    file="/dev/stdout"
    template="ServiceWithPID"
)

# Include any additional configuration files
include(file="/etc/rsyslog.d/*.conf")
